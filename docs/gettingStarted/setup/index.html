<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Setup | OpenHIM Mapping Mediator</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://jembi.github.io/openhim-mediator-mapping/docs/gettingStarted/setup"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Setup | OpenHIM Mapping Mediator"><meta data-react-helmet="true" name="description" content="The Mapping mediator can be setup within a NodeJS environment using Yarn or with Docker. In either case, it depends on MongoDB setup as a replica set. The mediator is configured using environment variables."><meta data-react-helmet="true" property="og:description" content="The Mapping mediator can be setup within a NodeJS environment using Yarn or with Docker. In either case, it depends on MongoDB setup as a replica set. The mediator is configured using environment variables."><link data-react-helmet="true" rel="icon" href="/openhim-mediator-mapping/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://jembi.github.io/openhim-mediator-mapping/docs/gettingStarted/setup"><link data-react-helmet="true" rel="alternate" href="https://jembi.github.io/openhim-mediator-mapping/docs/gettingStarted/setup" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://jembi.github.io/openhim-mediator-mapping/docs/gettingStarted/setup" hreflang="x-default"><link rel="stylesheet" href="/openhim-mediator-mapping/assets/css/styles.074c21e8.css">
<link rel="preload" href="/openhim-mediator-mapping/assets/js/runtime~main.e21a296f.js" as="script">
<link rel="preload" href="/openhim-mediator-mapping/assets/js/main.7b65363d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/openhim-mediator-mapping/"><div class="navbar__logo"><img src="/openhim-mediator-mapping/img/logo.png" alt="Mapper - OpenHIM Mediator" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/openhim-mediator-mapping/img/logo.png" alt="Mapper - OpenHIM Mediator" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Mapper</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/openhim-mediator-mapping/docs/gettingStarted/setup">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jembi/openhim-mediator-mapping" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/openhim-mediator-mapping/docs/gettingStarted/introduction">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openhim-mediator-mapping/docs/gettingStarted/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openhim-mediator-mapping/docs/gettingStarted/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/openhim-mediator-mapping/docs/gettingStarted/setup">Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openhim-mediator-mapping/docs/gettingStarted/endpoints">Endpoints</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openhim-mediator-mapping/docs/gettingStarted/api">Mapping Mediator API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openhim-mediator-mapping/docs/gettingStarted/samples">Sample Endpoint Schemas</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/openhim-mediator-mapping/docs/features/content-negotiation">Features</a></div></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Setup</h1></header><p>The Mapping mediator can be setup within a <a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">NodeJS</a> environment using <a href="https://yarnpkg.com/" target="_blank" rel="noopener noreferrer">Yarn</a> or with <a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer">Docker</a>. In either case, it depends on MongoDB setup as a replica set. The mediator is configured using environment variables.
Setting up the OpenHIM (Core and Console) is recommended but not required.</p><blockquote><p>This guide is aimed at Linux users.</p></blockquote><p>Follow our <a href="https://youtu.be/I6NTXZvJxW0" target="_blank" rel="noopener noreferrer">YouTube setup video</a> for a step by step guide.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">â€‹</a></h2><p>To store endpoint data:</p><ul><li><a href="https://docs.mongodb.com/manual/" target="_blank" rel="noopener noreferrer">MongoDB</a> &gt;= 3.6 as we need dotted key support (e.g. <code>{ &#x27;key.path&#x27;: &#x27;xyz&#x27; }</code>)</li><li>Your MongoDB set up needs to be a <a href="https://docs.mongodb.com/manual/replication/" target="_blank" rel="noopener noreferrer">replica set</a></li><li><a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">Docker</a></li><li><a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener noreferrer">Docker Compose</a></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="get-code-from-github">Get code from Github<a class="hash-link" href="#get-code-from-github" title="Direct link to heading">â€‹</a></h3><p>To get the OpenHIM Mediator Mapping code from GitHub, execute any of the below commands to get the codebase</p><p>Cloned repository:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">git clone https://github.com/jembi/openhim-mediator-mapping.git</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Zipped repository:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">wget https://github.com/jembi/openhim-mediator-mapping/archive/master.zip</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Zipped release version. Tagged releases can be downloaded by executing the below command, and replacing the &lt;RELEASE_VERSION&gt; placeholder with an actual <a href="https://github.com/jembi/openhim-mediator-mapping/releases" target="_blank" rel="noopener noreferrer">release tag</a>: E.g <code>v2.3.1</code></p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">wget https://github.com/jembi/openhim-mediator-mapping/releases/download/&lt;RELEASE_VERSION&gt;/build.openhim-mediator-mapping.&lt;RELEASE_VERSION&gt;.zip</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">Docker Mapper Setup</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">Yarn Mapper Setup</li></ul><div class="margin-vert--md"><div role="tabpanel"><h2 class="anchor anchorWithStickyNavbar_31ik" id="setup-mongo-replica-set-for-docker-env">Setup Mongo Replica Set for Docker Env<a class="hash-link" href="#setup-mongo-replica-set-for-docker-env" title="Direct link to heading">â€‹</a></h2><blockquote><p>Note: The Mongo replica set config between the <strong>docker and yarn setup instructions are NOT interchangeable</strong>.</p></blockquote><p>This set up guide will make use of <strong>Docker to run the Mongo cluster and the Mapping Mediator</strong>. The containers will connect with each other over a <code>Docker Network</code>.</p><p>The easiest way to setup the mongo containers is to use a <code>docker-compose</code> script. One is provided in the repo (<code>docker-compose.mongo.yml</code>)</p><p>Run the script from the project root directory with the following command:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">docker-compose -f docker-compose.mongo.yml up -d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Once the containers have started up exec into one of the containers with the following command, <code>docker exec -it mapper-mongo-1 mongo</code></p><p>Inside the shell enter the following:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">config = {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;_id&quot;: &quot;mapper-mongo-set&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;members&quot;: [</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;_id&quot;: 0,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;priority&quot;: 1,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;host&quot;: &quot;mapper-mongo-1:27017&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;_id&quot;: 1,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;priority&quot;: 0.5,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;host&quot;: &quot;mapper-mongo-2:27017&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;_id&quot;: 2,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;priority&quot;: 0.5,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;host&quot;: &quot;mapper-mongo-3:27017&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">rs.initiate(config)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="registering-with-the-openhim">Registering with the OpenHIM<a class="hash-link" href="#registering-with-the-openhim" title="Direct link to heading">â€‹</a></h2><p>The mapping mediator, like most other OpenHIM mediators, can register to an instance of the OpenHIM. This gives the user a graphical interface to interact with the mediator for status information and config options(if available).</p><blockquote><p>Note: For multiple instances of the mediator to register to the same instance of the OpenHIM each mediator has to have a unique <code>urn</code>. You can set the <code>urn</code> using the environment variable MEDIATOR_URN.</p></blockquote><p>To get an OpenHIM Core and Console instance setup, use the <code>docker-compose.openhim.yml</code> script here (or your preferred method). Run the docker compose command with the following:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">docker-compose -f docker-compose.openhim.yml up -d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Open a browser and navigate to <a href="http://localhost:9000" target="_blank" rel="noopener noreferrer">http://localhost:9000</a>. Login with the default username <strong><a href="mailto:root@openhim.org" target="_blank" rel="noopener noreferrer">root@openhim.org</a></strong> and password <strong>openhim-password</strong> then by-pass the security warnings. For more information on how to do this see <a href="https://youtu.be/F0bTS3qJlG0?t=173" target="_blank" rel="noopener noreferrer">our OpenHIM set up tutorial</a>. Finally, set your new openhim root user password.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="docker-mediator-start-up">Docker Mediator Start Up<a class="hash-link" href="#docker-mediator-start-up" title="Direct link to heading">â€‹</a></h3><p>To register as a mediator, you will need the following environment variables:</p><ul><li><code>OPENHIM_URL=https://openhim-core:8080</code></li><li><code>OPENHIM_PASSWORD={openhim_password}</code></li><li><code>MONGO_URL=mongodb://mapper-mongo-1:27017,mapper-mongo-2:27017,mapper-mongo-3:27017/mapping-mediator?replicaSet=mapper-mongo-set</code></li></ul><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">docker run -e OPENHIM_URL=https://openhim-core:8080 -e OPENHIM_PASSWORD={openhim_password} -e MONGO_URL=mongodb://mapper-mongo-1:27017,mapper-mongo-2:27017,mapper-mongo-3:27017/mapping-mediator?replicaSet=mapper-mongo-set --network mapper-cluster-network --name mapper -d jembi/openhim-mediator-mapping:latest</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>Note: <strong>The Mapping Mediator is not exposed to your local machine in this case</strong>. All requests would need to go through the OpenHIM. To expose the Mapping Mediator port to your local machine include the following flag in your run command: <code>-p 3003:3003</code></p></blockquote><p>To see the output logs of the mapping mediator run the following command:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">docker logs -f mapper</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here you should see the message: <strong>Successfully registered mediator!</strong></p><p>Finally, go back to your browser and navigate to the <code>Mediators</code> section. Here you should see your mapping mediator instance registered on the OpenHIM with a recent <em>heartbeat</em>.</p></div><div role="tabpanel" hidden=""><h2 class="anchor anchorWithStickyNavbar_31ik" id="setup-mongo-replica-set-for-yarn-env">Setup Mongo Replica Set for Yarn Env<a class="hash-link" href="#setup-mongo-replica-set-for-yarn-env" title="Direct link to heading">â€‹</a></h2><blockquote><p>Note: The Mongo replica set config between the <strong>docker and yarn setup instructions are NOT interchangeable</strong>.</p></blockquote><p>This set up guide will make use of <strong>Docker to run the MongoDB cluster</strong> and <strong>Yarn to run the Mapping Mediator</strong>. The MongoDB containers will connect with each other over a <code>Docker Network</code>. The Mapping Mediator will connect to the MongoDB Cluster via the <code>host network</code>.</p><p>The easiest way to setup the mongo containers is to use a <code>docker-compose</code> script. One is provided in the repo (<code>docker-compose.mongo.yml</code>)</p><p>Run the script from the project root directory with the following command:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">docker-compose -f docker-compose.mongo.yml up -d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Next, setup the replica set. Once the containers have started up exec into one of the containers with the following command, <code>docker exec -it mapper-mongo-1 mongo</code></p><p>Inside the shell enter the following:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">config = {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;_id&quot;: &quot;mapper-mongo-set&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;members&quot;: [</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;_id&quot;: 0,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;priority&quot;: 1,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;host&quot;: &quot;172.17.0.1:27017&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;_id&quot;: 1,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;priority&quot;: 0.5,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;host&quot;: &quot;172.17.0.1:27018&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;_id&quot;: 2,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;priority&quot;: 0.5,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;host&quot;: &quot;172.17.0.1:27019&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">rs.initiate(config)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p><strong>NOTE:</strong> The IP used here is the local docker bridge IP. This IP is generally consistent, however different docker configurations could result in differences. You can confirm your IP with this terminal command: <code>ifconfig docker0</code></p></blockquote><h2 class="anchor anchorWithStickyNavbar_31ik" id="registering-with-the-openhim-1">Registering with the OpenHIM<a class="hash-link" href="#registering-with-the-openhim-1" title="Direct link to heading">â€‹</a></h2><p>The mapping mediator, like most other OpenHIM mediators, can register to an instance of the OpenHIM. This gives the user a graphical interface to interact with the mediator for status information and config options(if available).</p><blockquote><p>Note: For multiple instances of the mediator to register to the same instance of the OpenHIM each mediator has to have a unique <code>urn</code>. You can set the <code>urn</code> using the environment variable MEDIATOR_URN.</p></blockquote><p>To get an OpenHIM Core and Console instance setup, use the <code>docker-compose.openhim.yml</code> script here (or your preferred method). Run the docker compose command with the following:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">docker-compose -f docker-compose.openhim.yml up -d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Open a browser and navigate to <a href="http://localhost:9000" target="_blank" rel="noopener noreferrer">http://localhost:9000</a>. Login with the default username <strong><a href="mailto:root@openhim.org" target="_blank" rel="noopener noreferrer">root@openhim.org</a></strong> and password <strong>openhim-password</strong> then by-pass the security warnings. For more information on how to do this see <a href="https://youtu.be/F0bTS3qJlG0?t=173" target="_blank" rel="noopener noreferrer">our OpenHIM set up tutorial</a>. Finally, set your new openhim root user password.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="yarn-mediator-start-up">Yarn Mediator Start Up<a class="hash-link" href="#yarn-mediator-start-up" title="Direct link to heading">â€‹</a></h2><p>From the project root run the following to install all the required dependencies:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">yarn</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p><strong>NB! Zipped Release Version</strong> - You do NOT have to run the <code>yarn</code> command as this has already been done in the release version. After downloading the specific release build, you can start the application by executing the <code>yarn start</code> command</p></blockquote><p>To register the mediator, you will need the following environment variables:</p><ul><li><code>MONGO_URL=&#x27;mongodb://localhost:27017,localhost:27018,localhost:27019/mapping-mediator?replicaSet=mapper-mongo-set&#x27;</code></li><li><code>OPENHIM_URL=https://localhost:8080</code></li><li><code>OPENHIM_PASSWORD={openhim_password}</code></li></ul><p>Substitute in your openhim password into the following command:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">MONGO_URL=&#x27;mongodb://localhost:27017,localhost:27018,localhost:27019/mapping-mediator?replicaSet=mapper-mongo-set&#x27; OPENHIM_URL=https://localhost:8080 OPENHIM_PASSWORD={openhim_password} yarn start</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Your mapper output logs should include the following:</p><div class="codeBlockContainer_K1bP language-txt theme-code-block"><div class="codeBlockContent_hGly txt"><pre tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">Server listening on port 3003...</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Connected to mongo on mongodb://localhost:27017,localhost:27018,localhost:27019/mapping-mediator?replicaSet=mapper-mongo-set</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">MongoDB Change Event Listeners Added</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Finally, go back to your browser and navigate to the <code>Mediators</code> section. Here you should see your mapping mediator instance registered on the OpenHIM with a recent <em>heartbeat</em></p></div></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="environment-variables">Environment Variables<a class="hash-link" href="#environment-variables" title="Direct link to heading">â€‹</a></h2><p>The supported environment variables are listed as follows:</p><table><thead><tr><th>Variable Name</th><th>Description</th><th>Default Value</th></tr></thead><tbody><tr><td>SERVER_PORT</td><td>The server port to start the application on</td><td><strong>3003</strong></td></tr><tr><td>LOG_LEVEL</td><td>The log level at which the logs should be printed out</td><td><strong>info</strong></td></tr><tr><td>ENABLE_LOGGING</td><td>Define if the application should print out any logs</td><td><strong>true</strong></td></tr><tr><td>MONGO_URL</td><td>The MongoDB url for connecting to the replica set database</td><td><strong>mongodb://localhost:27017,localhost:27018,localhost:27019/mapping-mediator?replicaSet=mapper-mongo-set</strong></td></tr><tr><td>OPENHIM_URL</td><td>The URL to the OpenHIM instance.<br>If running the OpenHIM in a docker container substitute in the <strong>container name</strong> instead of <strong>localhost</strong>.</td><td><a href="https://localhost:8080" target="_blank" rel="noopener noreferrer">https://localhost:8080</a></td></tr><tr><td>OPENHIM_USERNAME</td><td>The OpenHIM user to authenticate with</td><td><strong><a href="mailto:root@openhim.org" target="_blank" rel="noopener noreferrer">root@openhim.org</a></strong></td></tr><tr><td>OPENHIM_PASSWORD</td><td>The OpenHIM password for the supplied user to authenticate with</td><td><strong>openhim-password</strong></td></tr><tr><td>TRUST_SELF_SIGNED</td><td>Bypass the nodejs ssl certificate check on self signed certificates.<br>Only set this variable to <code>true</code> if you are using it in a non-production environment</td><td><strong>true</strong></td></tr><tr><td>OPENHIM_REGISTER</td><td>Set to <strong>false</strong> if you do not wish to have this mediator register itself with the openhim instance</td><td><strong>true</strong></td></tr><tr><td>ENABLE_LOGGING</td><td>Output logs</td><td><strong>true</strong></td></tr><tr><td>PARSER_LIMIT</td><td>Define the incoming body limit size. If the incoming body is bigger than the specified limit, the validation will fail</td><td><strong>1mb</strong></td></tr><tr><td>PARSER_XML_OPTIONS_TRIM</td><td>Trim the whitespace at the beginning and end of text nodes</td><td><strong>true</strong></td></tr><tr><td>PARSER_XML_OPTIONS_EXPLICIT_ROOT</td><td>Set this if you want to get the root node in the resulting object</td><td><strong>false</strong></td></tr><tr><td>PARSER_XML_OPTIONS_EXPLICIT_ARRAY</td><td>Always put child nodes in an array if true; otherwise an array is created only if there is more than one</td><td><strong>false</strong></td></tr><tr><td>VALIDATION_ACCEPT_NULL_VALUES</td><td>This is used to configure the validation middleware to accept <code>null</code> values</td><td><strong>false</strong></td></tr><tr><td>VALIDATION_COERCE_TYPES</td><td>Allow the validation middleware to coerce the incoming data values into the defined validation type. If the property validation type is defined  as <code>number</code> and the value being supplied is a <code>string</code>, then the validation middleware will format the value into a <code>number</code></td><td><strong>false</strong></td></tr><tr><td>DYNAMIC_ENDPOINTS</td><td>Define wether MongoDB should create a listener on the Endpoints collection to automatically apply endpoint changes</td><td><strong>true</strong></td></tr><tr><td>MEDIATOR_URN</td><td>Set a unique identifier to allow for multiple <code>openhim-mediator-mapping</code> instances to be registered to the OpenHIM.</td><td><strong>urn:mediator:generic_mapper</strong></td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/jembi/openhim-mediator-mapping/edit/master/docs/docs/gettingStarted/setup.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/openhim-mediator-mapping/docs/gettingStarted/quick-start"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Quick Start</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/openhim-mediator-mapping/docs/gettingStarted/endpoints"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Endpoints</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a><ul><li><a href="#get-code-from-github" class="table-of-contents__link toc-highlight">Get code from Github</a></li></ul></li><li><a href="#setup-mongo-replica-set-for-docker-env" class="table-of-contents__link toc-highlight">Setup Mongo Replica Set for Docker Env</a></li><li><a href="#registering-with-the-openhim" class="table-of-contents__link toc-highlight">Registering with the OpenHIM</a><ul><li><a href="#docker-mediator-start-up" class="table-of-contents__link toc-highlight">Docker Mediator Start Up</a></li></ul></li><li><a href="#setup-mongo-replica-set-for-yarn-env" class="table-of-contents__link toc-highlight">Setup Mongo Replica Set for Yarn Env</a></li><li><a href="#registering-with-the-openhim-1" class="table-of-contents__link toc-highlight">Registering with the OpenHIM</a></li><li><a href="#yarn-mediator-start-up" class="table-of-contents__link toc-highlight">Yarn Mediator Start Up</a></li><li><a href="#environment-variables" class="table-of-contents__link toc-highlight">Environment Variables</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Jembi Health Systems.</div></div></div></footer></div>
<script src="/openhim-mediator-mapping/assets/js/runtime~main.e21a296f.js"></script>
<script src="/openhim-mediator-mapping/assets/js/main.7b65363d.js"></script>
</body>
</html>