"use strict";(self.webpackChunkmapping_mediator=self.webpackChunkmapping_mediator||[]).push([[322],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return c}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=s(n),c=r,h=d["".concat(p,".").concat(c)]||d[c]||m[c]||o;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8215:function(e,t,n){var a=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:r},t)}},6396:function(e,t,n){n.d(t,{Z:function(){return d}});var a=n(3117),r=n(7294),o=n(2389),i=n(9443);var l=function(){var e=(0,r.useContext)(i.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},p=n(6681),s=n(6010),u="tabItem_1uMI";function m(e){var t,n,o,i=e.lazy,m=e.block,d=e.defaultValue,c=e.values,h=e.groupId,g=e.className,k=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),N=null!=c?c:k.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),f=(0,p.lx)(N,(function(e,t){return e.value===t.value}));if(f.length>0)throw new Error('Docusaurus error: Duplicate values "'+f.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===d?d:null!=(t=null!=d?d:null==(n=k.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(o=k[0])?void 0:o.props.value;if(null!==b&&!N.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+N.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var v=l(),y=v.tabGroupChoices,w=v.setTabGroupChoices,O=(0,r.useState)(b),M=O[0],T=O[1],E=[],S=(0,p.o5)().blockElementScrollPositionUntilNextRender;if(null!=h){var I=y[h];null!=I&&I!==M&&N.some((function(e){return e.value===I}))&&T(I)}var _=function(e){var t=e.currentTarget,n=E.indexOf(t),a=N[n].value;a!==M&&(S(t),T(a),null!=h&&w(h,a))},C=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=E.indexOf(e.currentTarget)+1;n=E[a]||E[0];break;case"ArrowLeft":var r=E.indexOf(e.currentTarget)-1;n=E[r]||E[E.length-1]}null==(t=n)||t.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":m},g)},N.map((function(e){var t=e.value,n=e.label,o=e.attributes;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:M===t?0:-1,"aria-selected":M===t,key:t,ref:function(e){return E.push(e)},onKeyDown:C,onFocus:_,onClick:_},o,{className:(0,s.Z)("tabs__item",u,null==o?void 0:o.className,{"tabs__item--active":M===t})}),null!=n?n:t)}))),i?(0,r.cloneElement)(k.filter((function(e){return e.props.value===M}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},k.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==M})}))))}function d(e){var t=(0,o.Z)();return r.createElement(m,(0,a.Z)({key:String(t)},e))}},8381:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return u},metadata:function(){return m},toc:function(){return d},default:function(){return h}});var a=n(3117),r=n(102),o=(n(7294),n(3905)),i=n(6396),l=n(8215),p=["components"],s={id:"setup",title:"Setup",sidebar_label:"Setup"},u=void 0,m={unversionedId:"gettingStarted/setup",id:"gettingStarted/setup",title:"Setup",description:"The Mapping mediator can be setup within a NodeJS environment using Yarn or with Docker. In either case, it depends on MongoDB setup as a replica set. The mediator is configured using environment variables.",source:"@site/docs/gettingStarted/setup.md",sourceDirName:"gettingStarted",slug:"/gettingStarted/setup",permalink:"/openhim-mediator-mapping/docs/gettingStarted/setup",editUrl:"https://github.com/jembi/openhim-mediator-mapping/edit/master/docs/docs/gettingStarted/setup.md",tags:[],version:"current",frontMatter:{id:"setup",title:"Setup",sidebar_label:"Setup"},sidebar:"someSidebar",previous:{title:"Quick Start",permalink:"/openhim-mediator-mapping/docs/gettingStarted/quick-start"},next:{title:"Endpoints",permalink:"/openhim-mediator-mapping/docs/gettingStarted/endpoints"}},d=[{value:"Prerequisites",id:"prerequisites",children:[{value:"Get code from Github",id:"get-code-from-github",children:[],level:3}],level:2},{value:"Setup Mongo Replica Set for Docker Env",id:"setup-mongo-replica-set-for-docker-env",children:[],level:2},{value:"Registering with the OpenHIM",id:"registering-with-the-openhim",children:[{value:"Docker Mediator Start Up",id:"docker-mediator-start-up",children:[],level:3}],level:2},{value:"Setup Mongo Replica Set for Yarn Env",id:"setup-mongo-replica-set-for-yarn-env",children:[],level:2},{value:"Registering with the OpenHIM",id:"registering-with-the-openhim-1",children:[],level:2},{value:"Yarn Mediator Start Up",id:"yarn-mediator-start-up",children:[],level:2},{value:"Environment Variables",id:"environment-variables",children:[],level:2}],c={toc:d};function h(e){var t=e.components,n=(0,r.Z)(e,p);return(0,o.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"The Mapping mediator can be setup within a ",(0,o.kt)("a",{parentName:"p",href:"https://nodejs.org/en/"},"NodeJS")," environment using ",(0,o.kt)("a",{parentName:"p",href:"https://yarnpkg.com/"},"Yarn")," or with ",(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/"},"Docker"),". In either case, it depends on MongoDB setup as a replica set. The mediator is configured using environment variables.\nSetting up the OpenHIM (Core and Console) is recommended but not required."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"This guide is aimed at Linux users.")),(0,o.kt)("p",null,"Follow our ",(0,o.kt)("a",{parentName:"p",href:"https://youtu.be/I6NTXZvJxW0"},"YouTube setup video")," for a step by step guide."),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,"To store endpoint data:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.mongodb.com/manual/"},"MongoDB")," >= 3.6 as we need dotted key support (e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"{ 'key.path': 'xyz' }"),")"),(0,o.kt)("li",{parentName:"ul"},"Your MongoDB set up needs to be a ",(0,o.kt)("a",{parentName:"li",href:"https://docs.mongodb.com/manual/replication/"},"replica set")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.docker.com/get-docker/"},"Docker")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.docker.com/compose/install/"},"Docker Compose"))),(0,o.kt)("h3",{id:"get-code-from-github"},"Get code from Github"),(0,o.kt)("p",null,"To get the OpenHIM Mediator Mapping code from GitHub, execute any of the below commands to get the codebase"),(0,o.kt)("p",null,"Cloned repository:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"git clone https://github.com/jembi/openhim-mediator-mapping.git\n")),(0,o.kt)("p",null,"Zipped repository:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"wget https://github.com/jembi/openhim-mediator-mapping/archive/master.zip\n")),(0,o.kt)("p",null,"Zipped release version. Tagged releases can be downloaded by executing the below command, and replacing the <RELEASE_VERSION> placeholder with an actual ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/jembi/openhim-mediator-mapping/releases"},"release tag"),": E.g ",(0,o.kt)("inlineCode",{parentName:"p"},"v2.3.1")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"wget https://github.com/jembi/openhim-mediator-mapping/releases/download/<RELEASE_VERSION>/build.openhim-mediator-mapping.<RELEASE_VERSION>.zip\n")),(0,o.kt)(i.Z,{defaultValue:"docker",values:[{label:"Docker Mapper Setup",value:"docker"},{label:"Yarn Mapper Setup",value:"yarn"}],mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"docker",mdxType:"TabItem"},(0,o.kt)("h2",{id:"setup-mongo-replica-set-for-docker-env"},"Setup Mongo Replica Set for Docker Env"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note: The Mongo replica set config between the ",(0,o.kt)("strong",{parentName:"p"},"docker and yarn setup instructions are NOT interchangeable"),".")),(0,o.kt)("p",null,"This set up guide will make use of ",(0,o.kt)("strong",{parentName:"p"},"Docker to run the Mongo cluster and the Mapping Mediator"),". The containers will connect with each other over a ",(0,o.kt)("inlineCode",{parentName:"p"},"Docker Network"),"."),(0,o.kt)("p",null,"The easiest way to setup the mongo containers is to use a ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose")," script. One is provided in the repo (",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.mongo.yml"),")"),(0,o.kt)("p",null,"Run the script from the project root directory with the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -f docker-compose.mongo.yml up -d\n")),(0,o.kt)("p",null,"Once the containers have started up exec into one of the containers with the following command, ",(0,o.kt)("inlineCode",{parentName:"p"},"docker exec -it mapper-mongo-1 mongo")),(0,o.kt)("p",null,"Inside the shell enter the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'config = {\n  "_id": "mapper-mongo-set",\n  "members": [\n    {\n      "_id": 0,\n      "priority": 1,\n      "host": "mapper-mongo-1:27017"\n    },\n    {\n      "_id": 1,\n      "priority": 0.5,\n      "host": "mapper-mongo-2:27017"\n    },\n    {\n      "_id": 2,\n      "priority": 0.5,\n      "host": "mapper-mongo-3:27017"\n    }\n  ]\n}\n\nrs.initiate(config)\n')),(0,o.kt)("h2",{id:"registering-with-the-openhim"},"Registering with the OpenHIM"),(0,o.kt)("p",null,"The mapping mediator, like most other OpenHIM mediators, can register to an instance of the OpenHIM. This gives the user a graphical interface to interact with the mediator for status information and config options(if available)."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note: For multiple instances of the mediator to register to the same instance of the OpenHIM each mediator has to have a unique ",(0,o.kt)("inlineCode",{parentName:"p"},"urn"),". You can set the ",(0,o.kt)("inlineCode",{parentName:"p"},"urn")," using the environment variable MEDIATOR_URN.")),(0,o.kt)("p",null,"To get an OpenHIM Core and Console instance setup, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.openhim.yml")," script here (or your preferred method). Run the docker compose command with the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -f docker-compose.openhim.yml up -d\n")),(0,o.kt)("p",null,"Open a browser and navigate to ",(0,o.kt)("a",{parentName:"p",href:"http://localhost:9000"},"http://localhost:9000"),". Login with the default username ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"mailto:root@openhim.org"},"root@openhim.org"))," and password ",(0,o.kt)("strong",{parentName:"p"},"openhim-password")," then by-pass the security warnings. For more information on how to do this see ",(0,o.kt)("a",{parentName:"p",href:"https://youtu.be/F0bTS3qJlG0?t=173"},"our OpenHIM set up tutorial"),". Finally, set your new openhim root user password."),(0,o.kt)("h3",{id:"docker-mediator-start-up"},"Docker Mediator Start Up"),(0,o.kt)("p",null,"To register as a mediator, you will need the following environment variables:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"OPENHIM_URL=https://openhim-core:8080")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"OPENHIM_PASSWORD={openhim_password}")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"MONGO_URL=mongodb://mapper-mongo-1:27017,mapper-mongo-2:27017,mapper-mongo-3:27017/mapping-mediator?replicaSet=mapper-mongo-set"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker run -e OPENHIM_URL=https://openhim-core:8080 -e OPENHIM_PASSWORD={openhim_password} -e MONGO_URL=mongodb://mapper-mongo-1:27017,mapper-mongo-2:27017,mapper-mongo-3:27017/mapping-mediator?replicaSet=mapper-mongo-set --network mapper-cluster-network --name mapper -d jembi/openhim-mediator-mapping:latest\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note: ",(0,o.kt)("strong",{parentName:"p"},"The Mapping Mediator is not exposed to your local machine in this case"),". All requests would need to go through the OpenHIM. To expose the Mapping Mediator port to your local machine include the following flag in your run command: ",(0,o.kt)("inlineCode",{parentName:"p"},"-p 3003:3003"))),(0,o.kt)("p",null,"To see the output logs of the mapping mediator run the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker logs -f mapper\n")),(0,o.kt)("p",null,"Here you should see the message: ",(0,o.kt)("strong",{parentName:"p"},"Successfully registered mediator!")),(0,o.kt)("p",null,"Finally, go back to your browser and navigate to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Mediators")," section. Here you should see your mapping mediator instance registered on the OpenHIM with a recent ",(0,o.kt)("em",{parentName:"p"},"heartbeat"),".")),(0,o.kt)(l.Z,{value:"yarn",mdxType:"TabItem"},(0,o.kt)("h2",{id:"setup-mongo-replica-set-for-yarn-env"},"Setup Mongo Replica Set for Yarn Env"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note: The Mongo replica set config between the ",(0,o.kt)("strong",{parentName:"p"},"docker and yarn setup instructions are NOT interchangeable"),".")),(0,o.kt)("p",null,"This set up guide will make use of ",(0,o.kt)("strong",{parentName:"p"},"Docker to run the MongoDB cluster")," and ",(0,o.kt)("strong",{parentName:"p"},"Yarn to run the Mapping Mediator"),". The MongoDB containers will connect with each other over a ",(0,o.kt)("inlineCode",{parentName:"p"},"Docker Network"),". The Mapping Mediator will connect to the MongoDB Cluster via the ",(0,o.kt)("inlineCode",{parentName:"p"},"host network"),"."),(0,o.kt)("p",null,"The easiest way to setup the mongo containers is to use a ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose")," script. One is provided in the repo (",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.mongo.yml"),")"),(0,o.kt)("p",null,"Run the script from the project root directory with the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -f docker-compose.mongo.yml up -d\n")),(0,o.kt)("p",null,"Next, setup the replica set. Once the containers have started up exec into one of the containers with the following command, ",(0,o.kt)("inlineCode",{parentName:"p"},"docker exec -it mapper-mongo-1 mongo")),(0,o.kt)("p",null,"Inside the shell enter the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'config = {\n  "_id": "mapper-mongo-set",\n  "members": [\n    {\n      "_id": 0,\n      "priority": 1,\n      "host": "172.17.0.1:27017"\n    },\n    {\n      "_id": 1,\n      "priority": 0.5,\n      "host": "172.17.0.1:27018"\n    },\n    {\n      "_id": 2,\n      "priority": 0.5,\n      "host": "172.17.0.1:27019"\n    }\n  ]\n}\n\nrs.initiate(config)\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"NOTE:")," The IP used here is the local docker bridge IP. This IP is generally consistent, however different docker configurations could result in differences. You can confirm your IP with this terminal command: ",(0,o.kt)("inlineCode",{parentName:"p"},"ifconfig docker0"))),(0,o.kt)("h2",{id:"registering-with-the-openhim-1"},"Registering with the OpenHIM"),(0,o.kt)("p",null,"The mapping mediator, like most other OpenHIM mediators, can register to an instance of the OpenHIM. This gives the user a graphical interface to interact with the mediator for status information and config options(if available)."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note: For multiple instances of the mediator to register to the same instance of the OpenHIM each mediator has to have a unique ",(0,o.kt)("inlineCode",{parentName:"p"},"urn"),". You can set the ",(0,o.kt)("inlineCode",{parentName:"p"},"urn")," using the environment variable MEDIATOR_URN.")),(0,o.kt)("p",null,"To get an OpenHIM Core and Console instance setup, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.openhim.yml")," script here (or your preferred method). Run the docker compose command with the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -f docker-compose.openhim.yml up -d\n")),(0,o.kt)("p",null,"Open a browser and navigate to ",(0,o.kt)("a",{parentName:"p",href:"http://localhost:9000"},"http://localhost:9000"),". Login with the default username ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"mailto:root@openhim.org"},"root@openhim.org"))," and password ",(0,o.kt)("strong",{parentName:"p"},"openhim-password")," then by-pass the security warnings. For more information on how to do this see ",(0,o.kt)("a",{parentName:"p",href:"https://youtu.be/F0bTS3qJlG0?t=173"},"our OpenHIM set up tutorial"),". Finally, set your new openhim root user password."),(0,o.kt)("h2",{id:"yarn-mediator-start-up"},"Yarn Mediator Start Up"),(0,o.kt)("p",null,"From the project root run the following to install all the required dependencies:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"yarn\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"NB! Zipped Release Version")," - You do NOT have to run the ",(0,o.kt)("inlineCode",{parentName:"p"},"yarn")," command as this has already been done in the release version. After downloading the specific release build, you can start the application by executing the ",(0,o.kt)("inlineCode",{parentName:"p"},"yarn start")," command")),(0,o.kt)("p",null,"To register the mediator, you will need the following environment variables:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"MONGO_URL='mongodb://localhost:27017,localhost:27018,localhost:27019/mapping-mediator?replicaSet=mapper-mongo-set'")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"OPENHIM_URL=https://localhost:8080")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"OPENHIM_PASSWORD={openhim_password}"))),(0,o.kt)("p",null,"Substitute in your openhim password into the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"MONGO_URL='mongodb://localhost:27017,localhost:27018,localhost:27019/mapping-mediator?replicaSet=mapper-mongo-set' OPENHIM_URL=https://localhost:8080 OPENHIM_PASSWORD={openhim_password} yarn start\n")),(0,o.kt)("p",null,"Your mapper output logs should include the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-txt"},"Server listening on port 3003...\nConnected to mongo on mongodb://localhost:27017,localhost:27018,localhost:27019/mapping-mediator?replicaSet=mapper-mongo-set\nMongoDB Change Event Listeners Added\n")),(0,o.kt)("p",null,"Finally, go back to your browser and navigate to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Mediators")," section. Here you should see your mapping mediator instance registered on the OpenHIM with a recent ",(0,o.kt)("em",{parentName:"p"},"heartbeat")))),(0,o.kt)("h2",{id:"environment-variables"},"Environment Variables"),(0,o.kt)("p",null,"The supported environment variables are listed as follows:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Variable Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"),(0,o.kt)("th",{parentName:"tr",align:null},"Default Value"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"SERVER_PORT"),(0,o.kt)("td",{parentName:"tr",align:null},"The server port to start the application on"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"3003"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"LOG_LEVEL"),(0,o.kt)("td",{parentName:"tr",align:null},"The log level at which the logs should be printed out"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"info"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"ENABLE_LOGGING"),(0,o.kt)("td",{parentName:"tr",align:null},"Define if the application should print out any logs"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"true"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"MONGO_URL"),(0,o.kt)("td",{parentName:"tr",align:null},"The MongoDB url for connecting to the replica set database"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"mongodb://localhost:27017,localhost:27018,localhost:27019/mapping-mediator?replicaSet=mapper-mongo-set"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"OPENHIM_URL"),(0,o.kt)("td",{parentName:"tr",align:null},"The URL to the OpenHIM instance.",(0,o.kt)("br",null),"If running the OpenHIM in a docker container substitute in the ",(0,o.kt)("strong",{parentName:"td"},"container name")," instead of ",(0,o.kt)("strong",{parentName:"td"},"localhost"),"."),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("a",{parentName:"td",href:"https://localhost:8080"},"https://localhost:8080"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"OPENHIM_USERNAME"),(0,o.kt)("td",{parentName:"tr",align:null},"The OpenHIM user to authenticate with"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},(0,o.kt)("a",{parentName:"strong",href:"mailto:root@openhim.org"},"root@openhim.org")))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"OPENHIM_PASSWORD"),(0,o.kt)("td",{parentName:"tr",align:null},"The OpenHIM password for the supplied user to authenticate with"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"openhim-password"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"TRUST_SELF_SIGNED"),(0,o.kt)("td",{parentName:"tr",align:null},"Bypass the nodejs ssl certificate check on self signed certificates.",(0,o.kt)("br",null),"Only set this variable to ",(0,o.kt)("inlineCode",{parentName:"td"},"true")," if you are using it in a non-production environment"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"true"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"OPENHIM_REGISTER"),(0,o.kt)("td",{parentName:"tr",align:null},"Set to ",(0,o.kt)("strong",{parentName:"td"},"false")," if you do not wish to have this mediator register itself with the openhim instance"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"true"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"ENABLE_LOGGING"),(0,o.kt)("td",{parentName:"tr",align:null},"Output logs"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"true"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"PARSER_LIMIT"),(0,o.kt)("td",{parentName:"tr",align:null},"Define the incoming body limit size. If the incoming body is bigger than the specified limit, the validation will fail"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"1mb"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"PARSER_XML_OPTIONS_TRIM"),(0,o.kt)("td",{parentName:"tr",align:null},"Trim the whitespace at the beginning and end of text nodes"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"true"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"PARSER_XML_OPTIONS_EXPLICIT_ROOT"),(0,o.kt)("td",{parentName:"tr",align:null},"Set this if you want to get the root node in the resulting object"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"false"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"PARSER_XML_OPTIONS_EXPLICIT_ARRAY"),(0,o.kt)("td",{parentName:"tr",align:null},"Always put child nodes in an array if true; otherwise an array is created only if there is more than one"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"false"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"VALIDATION_ACCEPT_NULL_VALUES"),(0,o.kt)("td",{parentName:"tr",align:null},"This is used to configure the validation middleware to accept ",(0,o.kt)("inlineCode",{parentName:"td"},"null")," values"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"false"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"VALIDATION_COERCE_TYPES"),(0,o.kt)("td",{parentName:"tr",align:null},"Allow the validation middleware to coerce the incoming data values into the defined validation type. If the property validation type is defined  as ",(0,o.kt)("inlineCode",{parentName:"td"},"number")," and the value being supplied is a ",(0,o.kt)("inlineCode",{parentName:"td"},"string"),", then the validation middleware will format the value into a ",(0,o.kt)("inlineCode",{parentName:"td"},"number")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"false"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"DYNAMIC_ENDPOINTS"),(0,o.kt)("td",{parentName:"tr",align:null},"Define wether MongoDB should create a listener on the Endpoints collection to automatically apply endpoint changes"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"true"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"MEDIATOR_URN"),(0,o.kt)("td",{parentName:"tr",align:null},"Set a unique identifier to allow for multiple ",(0,o.kt)("inlineCode",{parentName:"td"},"openhim-mediator-mapping")," instances to be registered to the OpenHIM."),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"urn:mediator:generic_mapper"))))))}h.isMDXComponent=!0}}]);